<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>demo</title>
  </head>
  <body style="height: 100vh">
    <div>
      While click this page, it will trigger `click` event, then task will pause
      for a while.
    </div>
    <button onclick="pause()">pause</button>
    <button onclick="resume()">resume</button>
    <button onclick="push()">push task</button>
    <button onclick="stopLoop()">stop loop</button>
    <button onclick="getIdleState()">get current idle state</button>
    <button onclick="setIntervalAndTimeout()">
      set interval and timeout faster
    </button>
    <button onclick="dispose()">dispose</button>
    <br />
    <br />
    <button onclick="ajaxRequestData()">mock ajax Request</button>
    <br />
    <button onclick="fetchRequestData()">mock fetch request data</button>
    <br />
    <br />
    <button onclick="location.href = location.href">refresh this page</button>

    <div id="box"></div>
    <script src="/dist/idle-state.js"></script>
    <script>
      const $box = document.querySelector('#box')

      const a = idle(
        () => {
          $box.innerHTML = 'do task 0'
        },
        {
          loop: true,
          timeout: 2000,
          interval: 500,
          // enableMousemove: true,
          tasks: [
            () => ($box.innerHTML = 'do task 1'),
            () => ($box.innerHTML = 'do task 2'),
          ],
          onDispose() {
            $box.innerHTML = 'task disposed'
          },
        }
      )

      function pause() {
        a.pause()
      }
      function resume() {
        a.resume()
      }

      function push() {
        const taskId = Math.random().toString(16).slice(-5)
        a.push(() => ($box.innerHTML = 'do task ' + taskId))
      }
      function stopLoop() {
        a.loop(false)
      }
      function getIdleState() {
        console.log(a.isIdle)
      }

      function setIntervalAndTimeout() {
        a.interval(100).timeout(500)
      }
      function dispose() {
        a.dispose(() => ($box.innerHTML = 'disposed'))
      }

      function ajaxRequestData() {
        const xhr = new XMLHttpRequest()
        xhr.open(
          'GET',
          'https://img0.baidu.com/it/u=1585999933,2052014070&fm=253&fmt=auto&app=138&f=JPEG?w=658&h=370',
          true
        )
        xhr.send()
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            console.log('`hxr` request done.')
          }
        }
      }

      function fetchRequestData() {
        fetch(
          'https://img0.baidu.com/it/u=1585999933,2052014070&fm=253&fmt=auto&app=138&f=JPEG?w=658&h=370'
        )
          .then((res) => {
            console.log('`fetch` request done.')
          })
          .catch((err) => {
            console.log(err)
          })
      }
    </script>
  </body>
</html>
