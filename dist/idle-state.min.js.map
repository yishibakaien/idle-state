{"version":3,"file":"idle-state.min.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["export const isFunction = (fn) => typeof fn === 'function'\r\n\r\nexport const isObject = (obj) =>\r\n  Object.prototype.toString.call(obj) === '[object Object]'\r\n\r\nexport const isArray = (obj) =>\r\n  Object.prototype.toString.call(obj) === '[object Array]'\r\n\r\n// unique array item\r\nexport const uniqueArray = (arr) => {\r\n  if (!isArray(arr)) {\r\n    return []\r\n  }\r\n\r\n  const ret = []\r\n  for (let i = 0; i < arr.length; i++) {\r\n    if (arr.indexOf(arr[i]) === i) {\r\n      ret.push(arr[i])\r\n    }\r\n  }\r\n  return ret\r\n}\r\n\r\nexport const next = (callback) => isFunction(callback) && callback()\r\n\r\nexport const noop = () => {}\r\n","import {\r\n  isArray,\r\n  isFunction,\r\n  isObject,\r\n  uniqueArray,\r\n  next,\r\n  noop,\r\n} from './utils.js'\r\n\r\nconst STATUS_START = 1\r\nconst STATUS_PAUSE = 2\r\nconst STATUS_STOP = 3\r\n\r\nclass Detector {\r\n  static events = [\r\n    'scroll',\r\n    'keydown',\r\n    'touchmove',\r\n    'touchstart',\r\n    'click',\r\n    // 'mousedown',\r\n    // 'wheel',\r\n    // 'mousewheel',\r\n    // 'mousemove',\r\n  ]\r\n\r\n  #isIdle = false\r\n  #timer = null\r\n  #status = STATUS_START\r\n  #index = 0\r\n\r\n  eventHandler = this.eventHandler.bind(this)\r\n\r\n  constructor(task, options = {}) {\r\n    if (isObject(task)) {\r\n      Object.assign(options, task)\r\n    }\r\n\r\n    if (isArray(task)) {\r\n      if (isArray(options.tasks)) {\r\n        options.tasks = task.concat(options.tasks)\r\n      } else {\r\n        options.tasks = task\r\n      }\r\n    }\r\n\r\n    // transform all tasks to a task array\r\n    if (isFunction(task)) {\r\n      if (isArray(options.tasks)) {\r\n        options.tasks = [task].concat(options.tasks)\r\n      } else {\r\n        options.tasks = [task]\r\n      }\r\n    }\r\n\r\n    const { events } = options\r\n    if (isArray(events)) {\r\n      Detector.events = Detector.events.concat(events)\r\n    }\r\n\r\n    this.options = {\r\n      target: document.body,\r\n      timeout: 3000,\r\n      interval: 1000,\r\n      loop: false,\r\n      enableMousemove: false,\r\n      tasks: [],\r\n      events: [],\r\n      onDispose: noop,\r\n      onPause: noop,\r\n      onResume: noop,\r\n      ...options,\r\n    }\r\n\r\n    /**\r\n     * mousemove events are frequently triggered in the browser,\r\n     * so put it configurable\r\n     */\r\n    if (this.options.enableMousemove) {\r\n      Detector.events.push('mousemove')\r\n    }\r\n\r\n    // remove repeat event\r\n    Detector.events = uniqueArray(Detector.events)\r\n\r\n    const element = this.options.target\r\n\r\n    Detector.events.forEach((event) => {\r\n      element.addEventListener(event, this.eventHandler)\r\n    })\r\n\r\n    this._start()\r\n  }\r\n\r\n  // controller of running tasks\r\n  _run() {\r\n    const { tasks, loop } = this.options\r\n\r\n    if (this.#status !== STATUS_START) {\r\n      return\r\n    }\r\n\r\n    if (!tasks.length) {\r\n      this.dispose()\r\n    }\r\n\r\n    const isLastTask = this.#index === tasks.length - 1\r\n\r\n    const task = tasks[this.#index]\r\n\r\n    next(task)\r\n\r\n    if (loop && isLastTask) {\r\n      this.#index = 0\r\n      this._start()\r\n    }\r\n\r\n    if (!loop && isLastTask) {\r\n      this.dispose()\r\n    }\r\n\r\n    if (!isLastTask) {\r\n      this.#index++\r\n      this._start()\r\n    }\r\n  }\r\n\r\n  _clearTimer() {\r\n    if (this.#timer) {\r\n      clearTimeout(this.#timer)\r\n      this.#timer = null\r\n    }\r\n  }\r\n\r\n  // start running tasks\r\n  _start() {\r\n    this._clearTimer()\r\n\r\n    const { interval, timeout } = this.options\r\n\r\n    const time = this.#isIdle ? interval : timeout\r\n\r\n    this.#timer = setTimeout(() => {\r\n      this.#isIdle = true\r\n      this._run()\r\n    }, time)\r\n  }\r\n\r\n  eventHandler() {\r\n    this.#isIdle = false\r\n    this._start()\r\n  }\r\n\r\n  /**\r\n   * pause running tasks\r\n   * callback passed by this has a higher priority than options\r\n   * @param {Function} cb\r\n   */\r\n  pause(cb) {\r\n    if (this.#status === STATUS_START) {\r\n      this.#status = STATUS_PAUSE\r\n      const callback = cb || this.options.onPause\r\n      next(callback)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * resume paused tasks\r\n   * callback passed by this has a higher priority than options\r\n   * @param {Function} cb\r\n   */\r\n  resume(cb) {\r\n    if (this.#status === STATUS_PAUSE) {\r\n      this.#status = STATUS_START\r\n      const callback = cb || this.options.onResume\r\n      next(callback)\r\n      this._start()\r\n    }\r\n  }\r\n\r\n  // dispose the resource & remove events handler\r\n  dispose(cb) {\r\n    this.#status = STATUS_STOP\r\n    this._clearTimer()\r\n    const element = this.options.target\r\n    Detector.events.forEach((evt) => {\r\n      element.removeEventListener(evt, this.eventHandler)\r\n    })\r\n    const callback = cb || this.options.onDispose\r\n    next(callback)\r\n  }\r\n\r\n  // convenience options for `dispose` API\r\n  stop(...args) {\r\n    this.dispose.apply(this, args)\r\n  }\r\n\r\n  // convenience options for `dispose` API\r\n  destroy(...args) {\r\n    this.dispose.apply(this, args)\r\n  }\r\n\r\n  // push a task\r\n  push(task) {\r\n    if (isFunction(task)) {\r\n      this.options.tasks.push(task)\r\n    }\r\n  }\r\n\r\n  // set tasks running timeout\r\n  timeout(timeout) {\r\n    this.options.timeout = timeout\r\n  }\r\n\r\n  // set tasks running interval\r\n  interval(interval) {\r\n    this.options.interval = interval\r\n  }\r\n\r\n  // set loop option\r\n  loop(value) {\r\n    this.options.loop = value\r\n  }\r\n\r\n  // get current idle status\r\n  isIdle() {\r\n    return this.#isIdle\r\n  }\r\n}\r\n\r\nexport default function (...args) {\r\n  return new Detector(...args)\r\n}\r\n"],"names":["next","callback","isFunction","fn","isObject","obj","Object","prototype","toString","call","isArray","uniqueArray","arr","ret","i","length","indexOf","push","noop","STATUS_START","Detector","task","options","this","eventHandler","bind","assign","tasks","concat","events","target","document","body","timeout","interval","loop","enableMousemove","onDispose","onPause","onResume","element","forEach","event","addEventListener","_this","_start","_classPrivateFieldGet","dispose","isLastTask","clearTimeout","_clearTimer","time","setTimeout","_this2","_run","cb","evt","removeEventListener","_this3","args","apply","value"],"mappings":"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"}